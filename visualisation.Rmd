---
title: "Visualisation"
author: "Harry Zhong"
date: "`r Sys.Date()`"
output: html_document
---

```{r}
source("scripts/packages.R")
```

Summarise based on artist.

```{r}
top_artists <- data.frame(
  month = full_streaming_history %>%
    select(month) %>%
    distinct()
) %>%
  mutate(
    top_artists = map(month,
                      ~full_streaming_history %>%
                        filter(month == .x) %>%
                        group_by(artist_name) %>%
                        summarise(time = sum(ms_played)) %>%
                        slice_max(time, n = 10) %>%
                        pull(artist_name))
  )

artist_summary <- full_streaming_history %>%
  left_join(top_artists,
            by = "month") %>%
  rowwise() %>%
  filter(artist_name %in% top_artists) %>%
  group_by(artist_name, month) %>%
  summarise(hours_listened = sum(ms_played/(1000*60)))

ggplot(artist_summary, aes(x = month, y = hours_listened, fill = artist_name, label = artist_name)) +
  geom_bar(position = "fill", stat = "identity") +
  geom_text(size = 3, position = position_fill(vjust = 0.5)) +
  theme(legend.position = "none")
```

Summarise based on kmeans cluster.

```{r}
cluster_summary <- full_streaming_history %>%
  select(month,
         track_name,
         artist_name,
         ms_played) %>%
  na.omit() %>%
  left_join(track_clusters, 
            by = c("track_name", "artist_name")) %>%
  group_by(month, cluster) %>%
  summarise(hours_listened = sum(ms_played/(1000*60)))

ggplot(cluster_summary, aes(x = month, y = hours_listened, fill = cluster, label = cluster)) +
  geom_bar(position = "fill", stat = "identity")

ggplot(cluster_summary, aes(x = month, y = hours_listened, fill = cluster, label = cluster)) +
  geom_bar(stat = "identity")
```

